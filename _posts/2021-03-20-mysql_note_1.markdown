---
layout: post
title:  "MySql45讲笔记-第九讲"
date:   2021-03-20 21:15:19 +0800
categories: jekyll update
---
## 总结
1、唯一索引和主键索引的区别
* 查询过程
对于普通索引来说，查找到满足条件的第一个记录(5,500)后，需要查找下一个记录，直到碰到第一个不满足k=5条件的记录。
对于唯一索引来说，由于索引定义了唯一性，查找到第一个满足条件的记录后，就会停止继续检索。
* 插入过程

2、change buffer
* change buffer在内存中有拷贝，也会存入磁盘
* 更新时，如果数据页没在内存，会先将更新放到change buffer，而不是读入数据页到buffer pool，这样可以节约内存占用，提高更新速度，
* 为了维护数据一致性，在读取数据页到内存时，change buffer中如果有相关的记录，会进行merge
* 除了读取时的别动merge外，系统有后台线程会定期merge。在数据库正常关闭（shutdown）的过程中，也会执行merge操作。
* **唯一索引是不可以使用change buffer的**，因为唯一索引插入数据时，需要校验是否已经存在当前插入的key，那么需要读入数据页到内存才可以判断，所以只有普通索引，才可以使用change buffer
* change buffer使用的是buffer pool中的内存，可以通过参数innodb_change_buffer_max_size来动态设置
* change buffer在merge之前，记录的数据越多越好。如果一个更新操作被计入change buffer，然后被马上读到，则失去了change buffer的优势，反而需要额外维护change buffer。
* 业务大量插入唯一索引，会导致数据库内存命中率下降

3、change buffer和redo log的区别
redo log 主要节省的是随机写磁盘的IO消耗（转成顺序写，在更新数据时，不是真正的写入到t.ibd，而是更新内存中的数据页，并将操作持久化到redolog），而change buffer主要节省的则是随机读磁盘的IO消耗。